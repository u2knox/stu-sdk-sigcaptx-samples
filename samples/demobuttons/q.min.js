!function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses)ses.ok()&&(ses.makeQ=t);else if("undefined"!=typeof window||"undefined"!=typeof self){var n="undefined"!=typeof window?window:self,e=n.Q;n.Q=t(),n.Q.noConflict=function(){return n.Q=e,this}}else throw Error("This environment was not anticipated by Q. Please file a bug.")}(function(){"use strict";var t,n,e,r=!1;try{throw Error()}catch(o){r=!!o.stack}var i=w(),u=function(){},c=function(){var t={task:void 0,next:null},n=t,e=!1,r=void 0,o=!1,i=[];function u(){for(var n,r;t.next;)n=(t=t.next).task,t.task=void 0,(r=t.domain)&&(t.domain=void 0,r.enter()),f(n,r);for(;i.length;)f(n=i.pop());e=!1}function f(t,n){try{t()}catch(e){if(o)throw n&&n.exit(),setTimeout(u,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}if(c=function(t){n=n.next={task:t,domain:o&&process.domain,next:null},e||(e=!0,r())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)o=!0,r=function(){process.nextTick(u)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,u):function(){setImmediate(u)};else if("undefined"!=typeof MessageChannel){var p=new MessageChannel;p.port1.onmessage=function(){r=s,p.port1.onmessage=u,u()};var s=function(){p.port2.postMessage(0)};r=function(){setTimeout(u,0),s()}}else r=function(){setTimeout(u,0)};return c.runAfter=function(t){i.push(t),e||(e=!0,r())},c}(),f=Function.call;function p(t){return function(){return f.apply(t,arguments)}}var s=p(Array.prototype.slice),a=p(Array.prototype.reduce||function(t,n){var e=0,r=this.length;if(1===arguments.length)for(;;){if(e in this){n=this[e++];break}if(++e>=r)throw TypeError()}for(;e<r;e++)e in this&&(n=t(n,this[e],e));return n}),l=p(Array.prototype.indexOf||function(t){for(var n=0;n<this.length;n++)if(this[n]===t)return n;return -1}),d=p(Array.prototype.map||function(t,n){var e=this,r=[];return a(e,function(o,i,u){r.push(t.call(n,i,u,e))},void 0),r}),h=Object.create||function(t){function n(){}return n.prototype=t,new n},y=p(Object.prototype.hasOwnProperty),v=Object.keys||function(t){var n=[];for(var e in t)y(t,e)&&n.push(e);return n},m=p(Object.prototype.toString);e="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var $="From previous event:";function k(t,n){if(r&&n.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf($)){for(var e=[],o=n;o;o=o.source)o.stack&&e.unshift(o.stack);e.unshift(t.stack);var i=e.join("\n"+$+"\n");t.stack=function t(n){for(var e=n.split("\n"),r=[],o=0;o<e.length;++o){var i=e[o];_(i)||j(i)||!i||r.push(i)}return r.join("\n")}(i)}}function j(t){return -1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function g(t){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(n)return[n[1],Number(n[2])];var e=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(e)return[e[1],Number(e[2])];var r=/.*@(.+):(\d+)$/.exec(t);if(r)return[r[1],Number(r[2])]}function _(t){var e=g(t);if(!e)return!1;var r=e[0],o=e[1];return r===n&&o>=i&&o<=z}function w(){if(r)try{throw Error()}catch(t){var e=t.stack.split("\n"),o=g(e[0].indexOf("@")>0?e[1]:e[2]);if(!o)return;return n=o[0],o[1]}}function x(t){var n,e;return t instanceof S?t:P(t)?(n=t,e=b(),x.nextTick(function(){try{n.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}}),e.promise):F(t)}function b(){var t,n=[],e=[],o=h(b.prototype),i=h(S.prototype);if(i.promiseDispatch=function(r,o,i){var u=s(arguments);n?(n.push(u),"when"===o&&i[1]&&e.push(i[1])):x.nextTick(function(){t.promiseDispatch.apply(t,u)})},i.valueOf=function(){if(n)return i;var e=D(t);return O(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},x.longStackSupport&&r)try{throw Error()}catch(u){i.stack=u.stack.substring(u.stack.indexOf("\n")+1)}function c(r){t=r,i.source=r,a(n,function(t,n){x.nextTick(function(){r.promiseDispatch.apply(r,n)})},void 0),n=void 0,e=void 0}return o.promise=i,o.resolve=function(n){!t&&c(x(n))},o.fulfill=function(n){!t&&c(F(n))},o.reject=function(n){!t&&c(E(n))},o.notify=function(n){!t&&a(e,function(t,e){x.nextTick(function(){e(n)})},void 0)},o}function R(t){if("function"!=typeof t)throw TypeError("resolver must be a function.");var n=b();try{t(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}return n.promise}function T(t){return R(function(n,e){for(var r=0,o=t.length;r<o;r++)x(t[r]).then(n,e)})}function S(t,n,e){void 0===n&&(n=function(t){return E(Error("Promise does not support operation: "+t))}),void 0===e&&(e=function(){return{state:"unknown"}});var r=h(S.prototype);if(r.promiseDispatch=function(e,o,i){var u;try{u=t[o]?t[o].apply(r,i):n.call(r,o,i)}catch(c){u=E(c)}e&&e(u)},r.inspect=e,e){var o=e();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var t=e();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function Q(t,n,e,r){return x(t).then(n,e,r)}function D(t){if(O(t)){var n=t.inspect();if("fulfilled"===n.state)return n.value}return t}function O(t){return t instanceof S}function P(t){var n;return(n=t)===Object(n)&&"function"==typeof t.then}x.resolve=x,x.nextTick=c,x.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(x.longStackSupport=!0),x.defer=b,b.prototype.makeNodeResolver=function(){var t=this;return function(n,e){n?t.reject(n):arguments.length>2?t.resolve(s(arguments,1)):t.resolve(e)}},x.Promise=R,x.promise=R,R.race=T,R.all=G,R.reject=E,R.resolve=x,x.passByCopy=function(t){return t},S.prototype.passByCopy=function(){return this},x.join=function(t,n){return x(t).join(n)},S.prototype.join=function(t){return x([this,t]).spread(function(t,n){if(t===n)return t;throw Error("Q can t join: not the same: "+t+" "+n)})},x.race=T,S.prototype.race=function(){return this.then(x.race)},x.makePromise=S,S.prototype.toString=function(){return"[object Promise]"},S.prototype.then=function(t,n,e){var r=this,o=b(),i=!1;return x.nextTick(function(){r.promiseDispatch(function(n){!i&&(i=!0,o.resolve(function n(e){try{return"function"==typeof t?t(e):e}catch(r){return E(r)}}(n)))},"when",[function(t){!i&&(i=!0,o.resolve(function t(e){if("function"==typeof n){k(e,r);try{return n(e)}catch(o){return E(o)}}return E(e)}(t)))}])}),r.promiseDispatch(void 0,"when",[void 0,function(t){var n,r,i=!1;try{r=(n=t,"function"==typeof e?e(n):n)}catch(u){if(i=!0,x.onerror)x.onerror(u);else throw u}i||o.notify(r)}]),o.promise},x.tap=function(t,n){return x(t).tap(n)},S.prototype.tap=function(t){return t=x(t),this.then(function(n){return t.fcall(n).thenResolve(n)})},x.when=Q,S.prototype.thenResolve=function(t){return this.then(function(){return t})},x.thenResolve=function(t,n){return x(t).thenResolve(n)},S.prototype.thenReject=function(t){return this.then(function(){throw t})},x.thenReject=function(t,n){return x(t).thenReject(n)},x.nearer=D,x.isPromise=O,x.isPromiseAlike=P,x.isPending=function t(n){return O(n)&&"pending"===n.inspect().state},S.prototype.isPending=function(){return"pending"===this.inspect().state},x.isFulfilled=function t(n){return!O(n)||"fulfilled"===n.inspect().state},S.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},x.isRejected=function t(n){return O(n)&&"rejected"===n.inspect().state},S.prototype.isRejected=function(){return"rejected"===this.inspect().state};var N=[],C=[],U=[],A=!0;function B(){N.length=0,C.length=0,A||(A=!0)}function E(t){var n,e,r=S({when:function(n){return n&&function t(n){if(A){var e=l(C,n);-1!==e&&("object"==typeof process&&"function"==typeof process.emit&&x.nextTick.runAfter(function(){var t=l(U,n);-1!==t&&(process.emit("rejectionHandled",N[e],n),U.splice(t,1))}),C.splice(e,1),N.splice(e,1))}}(this),n?n(t):this}},function t(){return this},function n(){return{state:"rejected",reason:t}});return n=r,e=t,A&&("object"==typeof process&&"function"==typeof process.emit&&x.nextTick.runAfter(function(){-1!==l(C,n)&&(process.emit("unhandledRejection",e,n),U.push(n))}),C.push(n),e&&void 0!==e.stack?N.push(e.stack):N.push("(no stack) "+e)),r}function F(t){return S({when:function(){return t},get:function(n){return t[n]},set:function(n,e){t[n]=e},delete:function(n){delete t[n]},post:function(n,e){return null==n?t.apply(void 0,e):t[n].apply(t,e)},apply:function(n,e){return t.apply(n,e)},keys:function(){return v(t)}},void 0,function n(){return{state:"fulfilled",value:t}})}function I(t,n,e){return x(t).spread(n,e)}function M(t,n,e){return x(t).dispatch(n,e)}function G(t){return Q(t,function(t){var n=0,e=b();return a(t,function(r,o,i){var u;O(o)&&"fulfilled"===(u=o.inspect()).state?t[i]=u.value:(++n,Q(o,function(r){t[i]=r,0==--n&&e.resolve(t)},e.reject,function(t){e.notify({index:i,value:t})}))},void 0),0===n&&e.resolve(t),e.promise})}function H(t){if(0===t.length)return x.resolve();var n=x.defer(),e=0;return a(t,function(r,o,i){var u=t[i];e++,Q(u,function t(e){n.resolve(e)},function t(){0==--e&&n.reject(Error("Q can t get fulfillment value from any promise, all promises were rejected."))},function t(e){n.notify({index:i,value:e})})},void 0),n.promise}function q(t){return Q(t,function(t){return t=d(t,x),Q(G(d(t,function(t){return Q(t,u,u)})),function(){return t})})}x.resetUnhandledRejections=B,x.getUnhandledReasons=function(){return N.slice()},x.stopUnhandledRejectionTracking=function(){B(),A=!1},B(),x.reject=E,x.fulfill=F,x.master=function t(n){return S({isDef:function(){}},function t(e,r){return M(n,e,r)},function(){return x(n).inspect()})},x.spread=I,S.prototype.spread=function(t,n){return this.all().then(function(n){return t.apply(void 0,n)},n)},x.async=function t(n){return function(){function t(t,n){var u,c;if("undefined"==typeof StopIteration){try{u=r[t](n)}catch(f){return E(f)}return u.done?x(u.value):Q(u.value,o,i)}try{u=r[t](n)}catch(p){if("[object StopIteration]"===m(c=p)||c instanceof e)return x(p.value);return E(p)}return Q(u,o,i)}var r=n.apply(this,arguments),o=t.bind(t,"next"),i=t.bind(t,"throw");return o()}},x.spawn=function t(n){x.done(x.async(n)())},x.return=function t(n){throw new e(n)},x.promised=function t(n){return function(){return I([this,G(arguments)],function(t,e){return n.apply(t,e)})}},x.dispatch=M,S.prototype.dispatch=function(t,n){var e=this,r=b();return x.nextTick(function(){e.promiseDispatch(r.resolve,t,n)}),r.promise},x.get=function(t,n){return x(t).dispatch("get",[n])},S.prototype.get=function(t){return this.dispatch("get",[t])},x.set=function(t,n,e){return x(t).dispatch("set",[n,e])},S.prototype.set=function(t,n){return this.dispatch("set",[t,n])},x.del=x.delete=function(t,n){return x(t).dispatch("delete",[n])},S.prototype.del=S.prototype.delete=function(t){return this.dispatch("delete",[t])},x.mapply=x.post=function(t,n,e){return x(t).dispatch("post",[n,e])},S.prototype.mapply=S.prototype.post=function(t,n){return this.dispatch("post",[t,n])},x.send=x.mcall=x.invoke=function(t,n){return x(t).dispatch("post",[n,s(arguments,2)])},S.prototype.send=S.prototype.mcall=S.prototype.invoke=function(t){return this.dispatch("post",[t,s(arguments,1)])},x.fapply=function(t,n){return x(t).dispatch("apply",[void 0,n])},S.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},x.try=x.fcall=function(t){return x(t).dispatch("apply",[void 0,s(arguments,1)])},S.prototype.fcall=function(){return this.dispatch("apply",[void 0,s(arguments)])},x.fbind=function(t){var n=x(t),e=s(arguments,1);return function t(){return n.dispatch("apply",[this,e.concat(s(arguments))])}},S.prototype.fbind=function(){var t=this,n=s(arguments);return function e(){return t.dispatch("apply",[this,n.concat(s(arguments))])}},x.keys=function(t){return x(t).dispatch("keys",[])},S.prototype.keys=function(){return this.dispatch("keys",[])},x.all=G,S.prototype.all=function(){return G(this)},x.any=H,S.prototype.any=function(){return H(this)},x.allResolved=(t=q,function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn("allResolved is deprecated, use allSettled instead.",Error("").stack),t.apply(t,arguments)}),S.prototype.allResolved=function(){return q(this)},x.allSettled=function t(n){return x(n).allSettled()},S.prototype.allSettled=function(){return this.then(function(t){return G(d(t,function(t){function n(){return t.inspect()}return(t=x(t)).then(n,n)}))})},x.fail=x.catch=function(t,n){return x(t).then(void 0,n)},S.prototype.fail=S.prototype.catch=function(t){return this.then(void 0,t)},x.progress=function t(n,e){return x(n).then(void 0,void 0,e)},S.prototype.progress=function(t){return this.then(void 0,void 0,t)},x.fin=x.finally=function(t,n){return x(t).finally(n)},S.prototype.fin=S.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw Error("Q can t apply finally callback");return t=x(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n})})},x.done=function(t,n,e,r){return x(t).done(n,e,r)},S.prototype.done=function(t,n,e){var r=function(t){x.nextTick(function(){if(k(t,o),x.onerror)x.onerror(t);else throw t})},o=t||n||e?this.then(t,n,e):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),o.then(void 0,r)},x.timeout=function(t,n,e){return x(t).timeout(n,e)},S.prototype.timeout=function(t,n){var e=b(),r=setTimeout(function(){n&&"string"!=typeof n||((n=Error(n||"Timed out after "+t+" ms")).code="ETIMEDOUT"),e.reject(n)},t);return this.then(function(t){clearTimeout(r),e.resolve(t)},function(t){clearTimeout(r),e.reject(t)},e.notify),e.promise},x.delay=function(t,n){return void 0===n&&(n=t,t=void 0),x(t).delay(n)},S.prototype.delay=function(t){return this.then(function(n){var e=b();return setTimeout(function(){e.resolve(n)},t),e.promise})},x.nfapply=function(t,n){return x(t).nfapply(n)},S.prototype.nfapply=function(t){var n=b(),e=s(t);return e.push(n.makeNodeResolver()),this.fapply(e).fail(n.reject),n.promise},x.nfcall=function(t){var n=s(arguments,1);return x(t).nfapply(n)},S.prototype.nfcall=function(){var t=s(arguments),n=b();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},x.nfbind=x.denodeify=function(t){if(void 0===t)throw Error("Q can t wrap an undefined function");var n=s(arguments,1);return function(){var e=n.concat(s(arguments)),r=b();return e.push(r.makeNodeResolver()),x(t).fapply(e).fail(r.reject),r.promise}},S.prototype.nfbind=S.prototype.denodeify=function(){var t=s(arguments);return t.unshift(this),x.denodeify.apply(void 0,t)},x.nbind=function(t,n){var e=s(arguments,2);return function(){var r=e.concat(s(arguments)),o=b();return r.push(o.makeNodeResolver()),x(function e(){return t.apply(n,arguments)}).fapply(r).fail(o.reject),o.promise}},S.prototype.nbind=function(){var t=s(arguments,0);return t.unshift(this),x.nbind.apply(void 0,t)},x.nmapply=x.npost=function(t,n,e){return x(t).npost(n,e)},S.prototype.nmapply=S.prototype.npost=function(t,n){var e=s(n||[]),r=b();return e.push(r.makeNodeResolver()),this.dispatch("post",[t,e]).fail(r.reject),r.promise},x.nsend=x.nmcall=x.ninvoke=function(t,n){var e=s(arguments,2),r=b();return e.push(r.makeNodeResolver()),x(t).dispatch("post",[n,e]).fail(r.reject),r.promise},S.prototype.nsend=S.prototype.nmcall=S.prototype.ninvoke=function(t){var n=s(arguments,1),e=b();return n.push(e.makeNodeResolver()),this.dispatch("post",[t,n]).fail(e.reject),e.promise},x.nodeify=function t(n,e){return x(n).nodeify(e)},S.prototype.nodeify=function(t){if(!t)return this;this.then(function(n){x.nextTick(function(){t(null,n)})},function(n){x.nextTick(function(){t(n)})})},x.noConflict=function(){throw Error("Q.noConflict only works when Q is used as a global")};var z=w();return x});